\documentclass[a4paper,11pt]{article}

%%
%%
%%
%%   SUPER GRAN BIG TODO: Cambiar los R_M por R_{MF} y los U_M por U_{MC} y explicar lo de la 
%%			  maquina de votar.
%%			 
%%			  Numeros de secuencia.
%%			  Escenarios de compromiso
%%			  Escenarios man in the middle y perdidas de paquetes
%%			En Bugs conocidos, como la urna puede saber lo que voto UNA sola persona
%%			que se halla ido a quejar porque su voto no cuenta, pero que tiene que hacer
%%			fraude y un monton de cosas más. Y no puede elegir a la persona como target.
%%

%% Paquetes Adicionales %%

\usepackage[spanish]{babel}
\selectlanguage{spanish}
\usepackage{fancyhdr}
\usepackage[dvips]{graphicx}
\usepackage[normal]{caption2}
\usepackage{amsfonts,amssymb,amsmath,amsthm}
\usepackage[T1]{fontenc}
\usepackage{url}
\usepackage{moreverb}


%% Declaracion de comandos %%

\newtheorem{lema}{Lema}
\newtheorem{teor}{Teorema}
\newtheorem{propos}{Proposici\'on}
\newtheorem{corol}{Corolario}


\newcommand{\mivec}[1]{\mathbf{#1}}
\newcommand{\vers}[1]{\mivec{\check{#1}}}
\newcommand{\deriv}[2]{\frac{\mathrm{d}#1}{\mathrm{d}#2}}
\newcommand{\expo}[1]{~10^{#1}}
\newcommand{\uni}[1]{\mathrm{#1}} 

\newcommand{\prop}[1]{\begin{propos} #1 \end{propos}}
\newcommand{\teo}[1]{\begin{teor} #1 \end{teor}}
\newcommand{\cor}[1]{\begin{corol} #1 \end{corol}}
\newcommand{\lem}[1]{\begin{lema} #1 \end{lema}}


%% Encabezado y Pie de Pagina %%

\pagestyle{fancy}
\lhead{Criptografía y Seguridad}
\chead{}
\rhead{ITBA}
\cfoot{\thepage}
\renewcommand{\footrulewidth}{0.4pt}

%% Titulo %%

\title{{\bf Sistema de voto electrónico}}
\author{M. Besio \and P. García \and E. Gómez Balaguer \and H. Rajchert}
\date{}

%% Comienzo del documento %%

\begin{document}
\maketitle
\thispagestyle{fancy}

\newpage

\tableofcontents

\newpage

%% COMIENZO DEL TEXTO %%

\section{Introducción}

En este trabajo analizamos el diseño e implementación de un sistema de voto electrónico. El mismo garantiza requerimientos de seguridad mediante el uso de primitivas criptográficas, conformando un protocolo.

\section{Diseño}

Para poder garantizar el anonimato de los votos en el sistema, planteamos el diseño separado en tres subsistemas. Con esto, logramos que en ninguna de las tres partes en ningún momento se encuentre la información suficiente para que se pueda asociar un voto con un votante. Estos tres subsistemas son:

\begin{itemize}
\item Votante: Esta es la terminal en que el usuario vota. Tiene que ser de su confianza.
\item Mesa: Se encarga de validar que cada votante esté registrado en el padrón, y le da un grupo de boletas para que envíe la que corresponda a su elección a la urna.
\item Urna: Tiene como función recibir los votos y entrega al votante el comprobante de votación (ticket).
\end{itemize}

Este esquema puede apreciarse en la figura \ref{esquema}. Allí también se indica con flechas el envío de mensajes entre subsistemas y el orden de los mismos.

\begin{center}
\begin{figure}
\includegraphics[scale=0.70]{esquema}
\caption{Esquema del sistema. Se indica con flechas el envío de mensajes entre subsistemas.}
\label{esquema}
\end{figure}
\end{center}

\subsection{Hipótesis}

Partimos de las siguientes hipótesis:
\begin{itemize}
\item Todos los votantes poseen claves públicas y privadas. 
\item Se puede relacionar los DNI de los votantes con su clave pública.
\item Todos los votantes conocen las claves públicas de los subsistemas.
\item Cada opción de voto (partidos, listas, etc.) posee una clave pública y una privada. La pública es conocida por todos.
\item La lista de opciones de voto es pública.
\item Los administradores de mesa y urna son distintos y no tienen manera de contactarse entre sí (no pueden confabular para modificar los resultados). De no cumplirse esta hipótesis el sistema sería muy fácilmente vulnerable ya que a través del entrecruzamiento de los datos que posee cada subsistema se podría relacionar un voto con su respectivo votante.
\end{itemize}

\subsection{Protocolo}

Con el fin de analizar el protocolo, adoptamos las siguientes convenciones:

\begin{itemize}
\item $U_M$: Clave pública del subsistema \emph{Mesa}.
\item $R_M$: Clave privada del subsistema \emph{Mesa}.
\item $U_U$: Clave pública del subsistema \emph{Urna}.
\item $R_U$: Clave privada del subsistema \emph{Urna}.
\item $U_{V_i}$: Clave pública del i-ésimo votante.
\item $R_{V_i}$: Clave privada del i-ésimo votante.
\item $S_{{VU}_i}$: Secreto compartido entre el i-ésimo votante y la urna.
\item $S_{{VM}_i}$: Secreto compartido entre el i-ésimo votante y la mesa.
\item $\text{DNI}$: Documento Nacional de Identidad del votante. Es su clave identificatoria.
\item $\text{ID}_V$: El ID de votación es una cadena que identifica la votación (única por elección).
\end{itemize}

Un proceso de votación consta de los siguientes 6 pasos:                                                        

\subsubsection{Paso 1}
\begin{scriptsize}
\begin{equation}
\text{Votante} \rightarrow \text{Mesa}: U_M \biggl[ U_U \left( S_{{VU}_i} \right) +  S_{{VM}_i} + U_{V_i} + R_{V_i} \Bigl[ \text{DNI}+ \text{ID}_V + \text{Hash} \Bigl( U_U \left( S_{{VU}_i} \right) + S_{{VM}_i}\Bigr) \Bigr]\biggr] 
\end{equation}
\end{scriptsize}


Para ir a votar, la persona le envía al subsistema \emph{Mesa} el siguiente mensaje encriptado con $U_M$ para que sólo la Mesa pueda saber su contenido, que consta de:
\begin{itemize}
 
\item Un secreto compartido entre la persona y la urna. Para hacer esto el votante genera un valor aleatorio (como él lo genera, lo conoce) y lo encripta con la clave pública de la urna, para que sólo esta pueda entenderlo. Este secreto va a ser utilizado por la urna para identificar al votante como válido.

\item Un secreto compartido entre la persona y la mesa. Al igual que en el anterior, este secreto es generado por la persona. Sirve para garantizarle a la mesa que el \textbf{hash} siguiente está bien formado y para evitar que la urna
pueda relacionar $S_{{VU}_i}$ con el DNI de la persona.

\item La clave pública de la persona. Es un primer intento de identificación, en este punto la mesa puede buscar en el padrón el DNI que corresponde a la clave suministrada.

\item Su DNI concatenado con el ID de la votación y un \textbf{hash}, y firmado con su clave privada. La mesa ya sabe qué DNI tiene que obtener por el item anterior, y como está firmado con $R_{V_i}$ sabe que sólo pudo haber sido creado por la persona. El ID sirve para que no se pueda utilizar el token en otra votación. El hash sirve para evitar que la mesa trate de generar su propio $S_{{VU}_i}$ (ver seccion \ref{mesa_gen_voto}). La mesa tiene que guardar este token completo a modo de comprobante de voto y la persona tiene que guardar $S_{{VU}_i}$  y $S_{{VM}_i}$ como la primera parte de su ticket.


%\item Su ticket, que está compuesto por el DNI de la persona, concatenado con un string aleatorio y encriptado con su clave pública. El ticket es algo que sólo la persona puede llegar a entender y le va a servir para averiguar si su voto está presente cuando se haga el conteo. Posteriormente, ese ticket será firmado digitalmente por la urna y por la mesa para que tenga validez.
\end{itemize}

\subsubsection{Paso 2}

\begin{footnotesize}
\begin{equation}
\text{Mesa} \rightarrow \text{Urna}: U_U \Bigl( R_M \bigl( U_U \left( S_{{VU}_i} \right) + \text{ID}_V \bigr) \Bigr)
\end{equation}
\end{footnotesize}

Después de verificar que la persona está registrada en el padrón y no votó, la mesa le envía a la urna el secreto $ U_U \left( S_{{VU}_i} \right)$ concatenado a el ID de votación, firmado con su clave privada $R_M$. De esta manera la mesa está diciendo que si bien no sabe el secreto, la persona que lo emitió está autorizada para votar (para la votación asignada al ID correspondiente).

\subsubsection{Paso 3}

\begin{footnotesize}
\begin{equation} \label{Math_boletas}
\text{Mesa} \rightarrow \text{Votante}: U_{V_i} \left( \text{Boletas} \right)
\end{equation}
\end{footnotesize} 

\begin{footnotesize}
\begin{equation}
\text{Boletas} = \sum_{i=0}^n R_M \left(\text{Opc}_i + \text{ID}_V + \text{RandA}_i \right)
\end{equation}
\end{footnotesize}
\\


La mesa le devuelve encriptada con $U_{V_i}$ (para que sólo la persona lo entienda) las distintas opciones que puede elegir - las boletas. Cada boleta está representada por la opción concatenada al ID de votación y a una cadena aleatoria. Están firmadas por la mesa para evitar que otra persona pueda generar una boleta válida.

\subsubsection{Paso 4}

\begin{footnotesize}
\begin{equation}
\text{Votante} \rightarrow \text{Urna}: U_U \left( S_{{VU}_i} + \text{Sobre} \right)
\end{equation}
\end{footnotesize}

\begin{footnotesize}
\begin{equation}
\text{Sobre} = U_{L_1} \circ U_{L_2} \circ \cdots \circ U_{L_n}\bigl( R_M \left(\text{Opc}_i + \text{ID}_V + \text{RandA}_i \right) + \text{RandB}_i  \bigr) 
\end{equation}
\end{footnotesize}

El votante elije uno de las boletas recibidas en el paso 3 y genera un sobre encriptando con las claves públicas de todas las listas (cada lista representa una opción en la boleta). La boleta elegida se concatena con un valor aleatorio $\text{RandB}_i$ para evitar que la mesa pueda regenerar todos los posibles sobres y saber a quién votó la persona.

Una vez generado el sobre, el votante procede a depositarlo (enviarlo) en la urna. Para hacerlo tiene que enviar (además del sobre) el secreto que sólo él y la urna conocen. La urna puede verificar que el secreto está autorizado por la mesa y marcar internamente que ese secreto está en proceso de votación (Para evitar que trate de votar dos veces).

\subsubsection{Paso 5}

\begin{footnotesize}
\begin{equation}
\text{Urna} \rightarrow \text{Mesa}: U_M \bigl( U_U \left( S_{{VU}_i} \right) + \text{Challenge} \bigr)
\end{equation}
\end{footnotesize}

Despúes de almacenar el voto, la urna informa a la mesa que la persona ya votó (para evitar que vuelva a votar) dándole $U_U \left( S_{{VU}_i} \right)$ que es el valor que la mesa utilizó para relacionar al votante. También le envía un \emph{Challenge} para que la mesa le devuelva firmado a modo de reconocimiento de voto. 


\subsubsection{Paso 6}
\begin{footnotesize}
\begin{equation}
\text{Mesa} \rightarrow \text{Urna}: U_U \bigl( R_M \left( \text{Challenge} \right) \bigr) 
\end{equation}
\end{footnotesize}
La mesa guarda como comprobante el par de datos $U_{V_i}$, $R_{V_i} \Bigl[ \text{DNI} + \text{ID}_V + \text{Hash} \bigl( U_U \left( S_{{VU}_i} \right) + S_{{VM}_i}\bigr) \Bigr]$.

Firma y le devuelve el challenge a la urna. Ambos marcan que la persona ya voto.


\subsubsection{Paso 7}

\begin{footnotesize}
\begin{equation}
\text{Urna} \rightarrow \text{Votante}: R_U \bigl( \text{Hash} \left( \text{Sobre}\right) \bigr) 
\end{equation}
\end{footnotesize}

%La urna firma el ticket previamente firmado por la mesa y se lo envía al votante (como comprobante de la operación).
Después de recibir el challenge firmado la urna La urna le aplica una función de hash al sobre recibido en el paso 4, lo firma y se lo devuelve al votante que lo utilizará como segunda parte de su ticket.

\section{Conteo y detección de fraude}
El conteo debe ser realizado en una máquina en la cual confíen todas las listas. La urna debe presentar los sobres y la mesa la lista con comprobantes de voto. Para abrir los sobres cada lista tiene que ingresar su clave privada. El conteo se realiza utilizando las cadenas $R_M \left(\text{Opc}_i + \text{ID}_V + \text{RandA}_i \right)$, que como fueron firmadas por la mesa garantizan la validez del sobre. 
Los partidos tienen que publicar dos listas, una con todos los $\text{Hash} \bigl( U_U \left( S_{{VU}_i} \right) + S_{{VM}_i}\bigr)$ obtenidos de los comprobantes de la mesa y otro con todos los $\text{Hash} \left( \text{Sobre}\right)$ obtenidos de los sobres de la urna. De esta manera cada votante puede buscar su ticket en las listas y verificar que realmente participó en la votación sin revelar a quien voto.

% Si una persona tiene un ticket firmado por la urna y la mesa y su ticket no está en la lista, quiere decir que su voto no ha contado. De esta manera se puede detectar fraude.

A continuación presentamos los distintos escenarios de ataque organizados por el sistema comprometido. Se puede notar que la votación puede ser anulada por la mesa o por la urna, lo que se trata de lograr es identificar quién fue el responsable del fraude.

\subsection{Ataques cometidos por la Mesa}
\subsubsection{Utilizar información de un votante para otras elecciones}
El comprobante que tiene la mesa (recibido en el paso 1) contiene un ID de votación, y está firmado por el votante. Es por eso que la mesa no puede generar un nuevo comprobante valido para otra elección y sin comprobante se puede demostrar que la mesa hizo fraude.

\subsubsection{Sacar un votante de la lista de comprobantes de voto}
Si la mesa elimina un comprobante la urna tendría más \mbox{$R_M \bigl( U_U \left( S_{{VU}_i} \right) + \text{ID}_V \bigr)$} que comprobantes de voto. Como está firmado por la mesa la urna no puede generarlos y de esta manera se puede contar todos los comprobantes de ambas partes y ver quien está cometiendo fraude. 

\subsubsection{Generar votos inválidos}\label{mesa_gen_voto}
La mesa puede generar un $S_{{VU}_i}$ encriptarlo con la clave pública de la urna y firmarlo para generar un sobre, pero no puede generar los comprobantes del tipo $U_{V_i}$, $R_{V_i} \Bigl[ \text{DNI}+ \text{ID}_V + \text{Hash} \Bigl( U_U \left( S_{{VU}_i} \right) + S_{{VM}_i}\Bigr) \Bigr]$ para sustentar el voto (porque utilizan la clave privada de cada votante).

\subsubsection{Identificar a un votante con un sobre}
Si no fuese por $\text{RandB}_i$ la mesa podría generar un hash de sobre para cada boleta que emitió en el paso 3 y probar si aparece en el archivo publicado por las listas. 

\subsection{Ataques cometidos por la urna}

\subsubsection{Modificar un voto}\label{modif_voto}
La urna no puede generar un sobre válido, porque la opción tiene que estar firmada por la mesa. Si decide modificar un sobre aleatoriamente lo estaría impugnando, pero como el usuario tiene como ticket un \textbf{hash} de ese sobre sabría que su voto fue modificado y podría denunciarlo. Además como no puede leer los sobres cualquier ataque de este tipo sería completamente aleatorio y no beneficiaría a ningún partido (en el caso de que el votante no denuncie a la urna).

\subsubsection{Mover un voto válido de una elección a otra}
La urna no puede utilizar una boleta de una votación a otra porque las boletas firmadas por la mesa contienen el ID de la votación. Además de que la opción tendría que ser válida en la nueva elección.

\subsubsection{Agregar o sacar votos}
La urna tiene que almacenar los $R_M \bigl( U_U \left( S_{{VU}_i} \right) + \text{ID}_V \bigr)$ recibidos en el paso 2, cuya cantidad debe ser la misma que la cantidad de sobres y de comprobantes de mesa. Caso contrario, hubo fraude de parte de la urna. Si saca un sobre, el votante puede darse cuenta por lo explicado en la subsección \ref{modif_voto}. Si agrega un sobre, no va a poder generar un secreto $S_{VU}$ encriptado firmado.

\subsubsection{Saber que votó una persona}
Informalmente: Si no estuviese $\text{RandB}_i$, la mesa, guardando las opciones firmadas del paso 3 y asociandolas al DNI, podría regenerar el \textbf{hash del sobre} para los distintos sobres posibles y así averiguar quien votó a quien.


\subsection{Ataques cometidos por un Votante}
\subsubsection{Anular la votación}
\subsubsection{Votar varias veces}
TODO


\section{Vulnerabilidades y restricciones conocidas}

\begin{thebibliography}{99}
\bibitem{linksecuriteam}``Secure Electronic Voting Over The World Wide Web'', Mark A. Herschberg, \url{http://theory.csail.mit.edu/~cis/theses/herschberg/all.pdf}.
\end{thebibliography}


\end{document} 
